"use strict";(()=>{var e={};e.id=748,e.ids=[748],e.modules={3480:(e,t,i)=>{e.exports=i(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6037:e=>{e.exports=require("mongoose")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},7672:(e,t,i)=>{i.r(t),i.d(t,{config:()=>c,default:()=>d,routeModule:()=>f});var r={};i.r(r),i.d(r,{default:()=>u});var n=i(3480),s=i(8667),a=i(6435),o=i(7872);async function u(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,error:"Method not allowed"});try{let i;await Object(function(){var e=Error("Cannot find module '../../../lib/mongodb.js'");throw e.code="MODULE_NOT_FOUND",e}())();let{registrationId:r,cnicNumber:n,action:s,notes:a}=e.body;if(!r&&!n)return t.status(400).json({success:!1,error:"Registration ID or CNIC number is required"});if(!(i=r?await o.A.findByRegistrationId(r):await o.A.findByCNIC(n)))return t.status(404).json({success:!1,error:"Registration not found"});if("verify"===s)await i.verifyRegistration(a),t.status(200).json({success:!0,message:"Registration verified successfully",data:{registrationId:i.registrationId,status:i.status,verificationDate:i.verificationDate}});else{if("reject"!==s)return t.status(400).json({success:!1,error:'Invalid action. Use "verify" or "reject"'});await i.rejectRegistration(a),t.status(200).json({success:!0,message:"Registration rejected",data:{registrationId:i.registrationId,status:i.status}})}}catch(e){console.error("❌ Verification Error:",e),t.status(500).json({success:!1,error:"Internal server error",message:"Verification failed due to server error"})}}!function(){var e=Error("Cannot find module '../../../lib/mongodb.js'");throw e.code="MODULE_NOT_FOUND",e}();let d=(0,a.M)(r,"default"),c=(0,a.M)(r,"config"),f=new n.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/registration/verify",pathname:"/api/registration/verify",bundlePath:"",filename:""},userland:r})},7872:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(6037),n=i.n(r);let s=new(n()).Schema({id:{type:String,required:!0},rawId:{type:String,required:!0},type:{type:String,required:!0,default:"public-key"},challenge:{type:String,required:!0},userId:{type:String,required:!0},timestamp:{type:Date,required:!0},deviceInfo:{userAgent:String,platform:String,language:String}},{_id:!1}),a=new(n()).Schema({cnicNumber:{type:String,required:!0,unique:!0,match:/^\d{13}$/,index:!0},firstName:{type:String,required:!0,trim:!0,maxlength:50},lastName:{type:String,required:!0,trim:!0,maxlength:50},dateOfBirth:{type:Date,required:!0,validate:{validator:function(e){let t=Math.floor((Date.now()-e)/315576e5);return t>=18&&t<=100},message:"Age must be between 18 and 100 years"}},province:{type:String,required:!0,enum:["Punjab","Sindh","Khyber Pakhtunkhwa","Balochistan","Gilgit"]},constituency:{type:String,required:!0,trim:!0},biometricData:{type:s,required:!0},registrationId:{type:String,unique:!0,default:function(){return"NADRA-"+Date.now().toString(36).toUpperCase()+"-"+Math.random().toString(36).substr(2,6).toUpperCase()}},status:{type:String,enum:["pending","verified","rejected","active"],default:"pending"},submissionTime:{type:Date,default:Date.now},lastUpdated:{type:Date,default:Date.now},ipAddress:String,userAgent:String,isVerified:{type:Boolean,default:!1},verificationDate:Date,verificationNotes:String},{timestamps:!0,toJSON:{transform:function(e,t){return delete t.__v,t}}});a.index({cnicNumber:1}),a.index({registrationId:1}),a.index({submissionTime:-1}),a.index({province:1,constituency:1}),a.index({status:1}),a.pre("save",function(e){this.lastUpdated=new Date,e()}),a.methods.verifyRegistration=function(e){return this.isVerified=!0,this.status="verified",this.verificationDate=new Date,this.verificationNotes=e||"Registration verified successfully",this.save()},a.methods.rejectRegistration=function(e){return this.status="rejected",this.verificationNotes=e||"Registration rejected",this.save()},a.statics.findByCNIC=function(e){return this.findOne({cnicNumber:e})},a.statics.findByRegistrationId=function(e){return this.findOne({registrationId:e})},a.statics.getRegistrationStats=function(){return this.aggregate([{$group:{_id:"$status",count:{$sum:1}}}])};let o=n().models.Registration||n().model("Registration",a)},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return i}});var i=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=7672);module.exports=i})();